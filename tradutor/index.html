<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    * {
      box-sizing: border-box;
    }

    html,body {
      height: 100%;
    }

    main {
      width: 600px;
      max-height: 800px;
    }

    .scrollable-div {
      height: 300px; /* Altura da div */
      overflow: auto; /* Adiciona rolagem quando necessário */
      padding: 10px; /* Espaçamento interno */
    }

    #output-area {
      border: 1px solid gray;
      border-radius: 3px;
      padding: 5px;
      position: relative;
      min-height: 100px;
    }

    #output-tarea {
      padding: 5px;
      height: 300px;
    }

    #output-area > #copy-btn {
      position: absolute;
      right: 5px;
    }

    .ellipsis {
      max-width: 100%; /* Largura do contêiner */
      white-space: nowrap; /* Impede que o texto quebre em várias linhas */
      overflow: hidden; /* Oculta o texto que excede o contêiner */
      text-overflow: ellipsis; /* Adiciona '...' ao final do texto cortado */
    }
  </style>
  <title>Tradutor Automático | By: JWESLEYLIMA</title>
</head>
<body class="bg-light">
  <div id="app" class="row d-flex flex-column justify-content-center align-items-center">
    <div v-if="apiKeyPage">
      <main class="col-12 col-md-6 offset-md-3 d-flex flex-column bg-white shadow-sm p-5 mt-5">
        <div class="d-flex flex-column justify-content-center align-items-center">
          <h1 class="display-4 m-0">Inserir Chave de API</h1>
          <input type="text" class="form-control mt-3" v-model="apiKey" placeholder="Digite aqui...">
          <button class="btn btn-primary mt-2" :disabled="!apiKey" @click="apiKeyPage = false"><span class="me-1">Continuar</span> <i class="fa fa-arrow-right"></i></button>
        </div>
      </main>
    </div>
    <div v-else>
      <div v-if="errorTranslating" class="d-flex flex-column align-items-center p-2">
        <i class="fa fa-exclamation-circle text-danger"></i>
        <span class="text-danger text-center">{{ error }}</span>
      </div>
      <main class="col-12 offset-md-3 col-md-6 d-flex flex-column bg-white shadow-sm p-5 mt-5">
        <div class="d-flex flex-column justify-content-center align-items-center">
          <h1 class="display-4 m-0">Tradutor Automático</h1>
          <span class="text-muted mt-1 ellipsis">Sua API Key é: <span class="ellipsis" :class="{ 'text-primary': apiKey, 'text-danger': !apiKey }">{{ apiKey || 'Não definida' }}</span></span>
        </div>
        <textarea name="input" id="input" class="mt-4" placeholder="Digite o texto..." :disabled="isTranslating" v-model="originalText"></textarea>
        <div class="d-flex align-items-center mt-3">
          <label for="targetLang">Língua alvo:</label>
          <select name="targetLang" id="targetLang" class="ms-2" v-model="targetLang" :disabled="isTranslating">
            <option value="pt">Português do Brasil</option>
          </select>
        </div>
        <h2 class="mt-3 h4">Resultado:</h2>
        <div v-if="isTranslating || !translatedText" name="output" id="output-area" class="mt-2" disabled>
          <div class="scrollable-div">
            <div v-if="isTranslating" class="d-flex flex-column justify-content-center align-items-center mt-3">
              <span class="spinner-border spinner-border-sm"></span>
              <span class="text-muted mt-2">Traduzindo</span>
            </div>
            <div v-else-if="translatedText === null" class="d-flex flex-column justify-content-center align-items-center mt-3">
              <i class="fa fa-info-circle text-secondary"></i>
              <span class="text-muted text-center">Digite algo e clique em <span class="text-primary">Traduzir</span> para começar</span>
            </div>
          </div>
        </div>
        <textarea v-else name="output-tarea" id="output-tarea" readonly>{{ translatedText }}</textarea>
        <div class="d-flex justify-content-center align-items-center"></div>
        <button id="copy-btn" class="btn btn-primary fa fa-copy mt-2" :disabled="!translatedText" @click="copyResultToClipboard"></button>
        <button :disabled="!apiKey || originalText.length === 0 || isTranslating" @click="requestTranslate" class="btn btn-primary mt-2">Traduzir</button>
      </main>
    </div>
    <footer class="d-flex justify-content-center align-items-center mt-4">
      <span class="text-muted">Desenvolvido por <a href="https://github.com/jwesleylima" target="_blank">JWesleyLima</a></span>
    </footer>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
  <script>
    new Vue({
      el: '#app',
      data: {
        apiKeyPage: true,
        apiKey: '',
        originalText: '',
        targetLang: 'pt',
        translatedText: null,
        error: '',
        errorTranslating: false,
        isTranslating: false
      },
      computed: {
        API_URL() {
          return `https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=${this.targetLang}`
        }
      },
      methods: {
        formatLineBreaks(text) {
          return text.replace(/\n/g, '<br>');
        },
        copyResultToClipboard() {
          navigator.clipboard.writeText(this.translatedText)
          .then(() => {
            alert('Copiado com sucesso!')
          })
          .catch(err => {
            console.error(err);
            alert('Erroa ao copiar')
          });
        },
        async requestTranslate() {
          if (!this.apiKey) {
            alert('Uma API Key deve ser fornecida');
            this.apiKeyPage = true;
            return;
          }

          this.isTranslating = true;
          this.errorTranslating = false;
          this.error = '';

          const response = await fetch(this.API_URL,  {
            method: 'post',
            headers: {
              'Content-Type': 'application/json',
              'Ocp-Apim-Subscription-Key': this.apiKey,
              'Ocp-Apim-Subscription-Region': 'brazilsouth'
            },
            body: JSON.stringify([
              {
                'Text': this.originalText
              }
            ])
          })

          if (!response.ok) {
            this.errorTranslating = true;
            this.error = `Erro ao traduzir! Seu acesso pode ter sido limitado ou sua chave de API pode estar inválida!`
          } else {
            const data = await response.json();
            this.translatedText = data?.[0]?.translations?.[0]?.text;
            console.log(this.translatedText)
          }

          console.log(response)
          this.isTranslating = false;
        }
      }
    })
  </script>
</body>
</html>
